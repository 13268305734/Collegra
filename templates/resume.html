{% extends 'base.html' %}
{% block title %}Resume Generator{% endblock %}
{% block head %}
    <style>
        .form-section {
            margin-bottom: 20px;
        }
        .entry {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .extra-field {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .extra-field input {
            width: 48%;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            background: #f1f5f9;
            border-radius: 8px;
            color: #1f2937;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
{% endblock %}
{% block content %}
    <div class="container" style="padding: 40px;">
        <form id="cvForm" class="w-full">
            <!-- Personal Information -->
            <div class="personal-information form-section">
                <h2 class="text-xl font-semibold text-gray-800 lang-zh">个人信息</h2>
                <h2 class="text-xl font-semibold text-gray-800 lang-en hidden">Personal Information</h2>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">姓名</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Name</label>
                    <input type="text" id="name" name="Name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：张伟">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">地点</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Location</label>
                    <input type="text" id="location" name="Location" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：中国广州">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">电子邮件</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Email</label>
                    <input type="email" id="email" name="Email" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：zhangwei@example.com">
                </div>
            </div>

            <!-- Education -->
            <div class="education form-section">
                <h2 class="text-xl font-semibold text-gray-800 lang-zh">教育经历 (可选)</h2>
                <h2 class="text-xl font-semibold text-gray-800 lang-en hidden">Education (Optional)</h2>
                <div id="educationEntries">
                    <div class="entry">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">机构</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Institution</label>
                            <input type="text" name="education_institution" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：中山大学">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">时间段</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Duration</label>
                            <input type="text" name="education_duration" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：2023年9月 - 至今">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">学位</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Degree</label>
                            <input type="text" name="education_degree" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：计算机科学与技术学士">
                        </div>
                        <div class="extra-fields lang-zh">额外信息（可选）</div>
                        <div class="extra-fields lang-en hidden">Extra Details (Optional)</div>
                        <div class="extra-container"></div>
                        <button type="button" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-zh" onclick="addExtraField(this)">添加额外信息</button>
                        <button type="button" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-en hidden" onclick="addExtraField(this)">Add Extra Detail</button>
                        <button type="button" class="mt-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
                    </div>
                </div>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-zh" onclick="addEducation()">添加教育经历</button>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-en hidden" onclick="addEducation()">Add Education</button>
            </div>

            <!-- Experience -->
            <div class="experience form-section">
                <h2 class="text-xl font-semibold text-gray-800 lang-zh">工作经历 (可选)</h2>
                <h2 class="text-xl font-semibold text-gray-800 lang-en hidden">Experience (Optional)</h2>
                <div id="experienceEntries">
                    <div class="entry">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">隶属机构</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Affiliation</label>
                            <input type="text" name="experience_affiliation" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：中山大学">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">地点</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Location</label>
                            <input type="text" name="experience_location" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：中国广州">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">时间段</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Duration</label>
                            <input type="text" name="experience_duration" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：2024年6月 - 至今">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">职位</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Position</label>
                            <input type="text" name="experience_position" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：研究助理">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">描述（每行一条）</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Descriptions (one per line)</label>
                            <textarea name="experience_descriptions" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：开发AI模型\n发表研究"></textarea>
                        </div>
                        <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
                    </div>
                </div>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-zh" onclick="addExperience()">添加工作经历</button>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-en hidden" onclick="addExperience()">Add Experience</button>
            </div>

            <!-- Publications -->
            <div class="publications form-section">
                <h2 class="text-xl font-semibold text-gray-800 lang-zh">论文发表 (可选)</h2>
                <h2 class="text-xl font-semibold text-gray-800 lang-en hidden">Publications (Optional)</h2>
                <div id="publicationEntries">
                    <div class="entry">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">作者（逗号分隔）</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Authors (comma-separated)</label>
                            <input type="text" name="publication_authors" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：张伟, 李明">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">标题</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Title</label>
                            <input type="text" name="publication_title" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：人工智能进展">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">出版物</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Venue</label>
                            <input type="text" name="publication_venue" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：NeurIPS">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">年份</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Year</label>
                            <input type="text" name="publication_year" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：2025">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">网址（可选）</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">URL (Optional)</label>
                            <input type="text" name="publication_url" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：https://arxiv.org/abs/1234.5678">
                        </div>
                        <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
                    </div>
                </div>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-zh" onclick="addPublication()">添加论文</button>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-en hidden" onclick="addPublication()">Add Publication</button>
            </div>

            <!-- Projects -->
            <div class="projects form-section">
                <h2 class="text-xl font-semibold text-gray-800 lang-zh">项目 (可选)</h2>
                <h2 class="text-xl font-semibold text-gray-800 lang-en hidden">Projects (Optional)</h2>
                <div id="projectEntries">
                    <div class="entry">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">标题</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Title</label>
                            <input type="text" name="project_title" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：AI图像生成项目">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">描述（每行一条）</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Descriptions (one per line)</label>
                            <textarea name="project_descriptions" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：构建神经网络\n获奖"></textarea>
                        </div>
                        <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
                    </div>
                </div>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-zh" onclick="addProject()">添加项目</button>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-en hidden" onclick="addProject()">Add Project</button>
            </div>

            <!-- Skills -->
            <div class="skills form-section">
                <h2 class="text-xl font-semibold text-gray-800 lang-zh">技能 (可选)</h2>
                <h2 class="text-xl font-semibold text-gray-800 lang-en hidden">Skills (Optional)</h2>
                <div id="skillEntries">
                    <div class="entry">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">类别</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Category</label>
                            <input type="text" name="skill_category" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：编程语言">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">项目</label>
                            <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Items</label>
                            <input type="text" name="skill_items" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：Python, Java">
                        </div>
                        <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
                    </div>
                </div>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-zh" onclick="addSkill()">添加技能类别</button>
                <button type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-en hidden" onclick="addSkill()">Add Skill Category</button>
            </div>

            <button type="submit" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 lang-zh">生成简历</button>
            <button type="submit" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 lang-en hidden">Generate CV</button>
        </form>
        <div id="output" class="hidden"></div>
    </div>

    <script>
        function addExtraField(button) {
            const container = button.parentElement.querySelector('.extra-container');
            const extraField = document.createElement('div');
            extraField.className = 'extra-field';
            extraField.innerHTML = `
                <input type="text" name="education_extra_key" class="w-1/2 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：GPA">
                <input type="text" name="education_extra_value" class="w-1/2 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：4.0/4.0">
                <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="this.parentElement.remove()">移除</button>
            `;
            container.appendChild(extraField);
        }

        function addEducation() {
            const container = document.getElementById('educationEntries');
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">机构</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Institution</label>
                    <input type="text" name="education_institution" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：中山大学">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">时间段</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Duration</label>
                    <input type="text" name="education_duration" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：2023年9月 - 至今">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">学位</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Degree</label>
                    <input type="text" name="education_degree" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：计算机科学与技术学士">
                </div>
                <div class="extra-fields lang-zh">额外信息（可选）</div>
                <div class="extra-fields lang-en hidden">Extra Details (Optional)</div>
                <div class="extra-container"></div>
                <button type="button" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-zh" onclick="addExtraField(this)">添加额外信息</button>
                <button type="button" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 lang-en hidden" onclick="addExtraField(this)">Add Extra Detail</button>
                <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
            `;
            container.appendChild(entry);
        }

        function addExperience() {
            const container = document.getElementById('experienceEntries');
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">隶属机构</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Affiliation</label>
                    <input type="text" name="experience_affiliation" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：中山大学">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">地点</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Location</label>
                    <input type="text" name="experience_location" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：中国广州">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">时间段</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Duration</label>
                    <input type="text" name="experience_duration" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：2024年6月 - 至今">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">职位</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Position</label>
                    <input type="text" name="experience_position" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：研究助理">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">描述（每行一条）</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Descriptions (one per line)</label>
                    <textarea name="experience_descriptions" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：开发AI模型\n发表研究"></textarea>
                </div>
                <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
            `;
            container.appendChild(entry);
        }

        function addPublication() {
            const container = document.getElementById('publicationEntries');
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">作者（逗号分隔）</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Authors (comma-separated)</label>
                    <input type="text" name="publication_authors" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：张伟, 李明">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">标题</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Title</label>
                    <input type="text" name="publication_title" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：人工智能进展">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">出版物</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Venue</label>
                    <input type="text" name="publication_venue" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：NeurIPS">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">年份</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Year</label>
                    <input type="text" name="publication_year" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：2025">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">网址（可选）</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">URL (Optional)</label>
                    <input type="text" name="publication_url" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：https://arxiv.org/abs/1234.5678">
                </div>
                <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
            `;
            container.appendChild(entry);
        }

        function addProject() {
            const container = document.getElementById('projectEntries');
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">标题</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Title</label>
                    <input type="text" name="project_title" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：AI图像生成项目">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">描述（每行一条）</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Descriptions (one per line)</label>
                    <textarea name="project_descriptions" rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：构建神经网络\n获奖"></textarea>
                </div>
                <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
            `;
            container.appendChild(entry);
        }

        function addSkill() {
            const container = document.getElementById('skillEntries');
            const entry = document.createElement('div');
            entry.className = 'entry';
            entry.innerHTML = `
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">类别</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Category</label>
                    <input type="text" name="skill_category" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：编程语言">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-zh">项目</label>
                    <label class="block text-sm font-medium text-gray-700 mb-2 lang-en hidden">Items</label>
                    <input type="text" name="skill_items" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600" placeholder="例如：Python, Java">
                </div>
                <button type="button" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700" onclick="removeEntry(this)">移除</button>
            `;
            container.appendChild(entry);
        }

        function removeEntry(button) {
            button.parentElement.remove();
        }

        document.getElementById('cvForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(this);
            const data = {
                language: document.getElementById('languageSelect').value, // Use base.html's language toggle value
                Name: formData.get('Name'),
                Location: formData.get('Location'),
                Email: formData.get('Email')
            };

            // Collect Education (include key only if non-empty)
            const educationEntries = document.querySelectorAll('#educationEntries .entry');
            const education = [];
            educationEntries.forEach(entry => {
                const institution = entry.querySelector('[name="education_institution"]').value.trim();
                const duration = entry.querySelector('[name="education_duration"]').value.trim();
                const degree = entry.querySelector('[name="education_degree"]').value.trim();
                if (institution || duration || degree) {
                    const educationItem = { institution, duration, degree };
                    const extraFields = entry.querySelectorAll('.extra-field');
                    extraFields.forEach(field => {
                        const key = field.querySelector('[name="education_extra_key"]').value.trim();
                        const value = field.querySelector('[name="education_extra_value"]').value.trim();
                        if (key && value) {
                            educationItem[key] = value;
                        }
                    });
                    education.push(educationItem);
                }
            });
            if (education.length > 0) {
                data.Education = education;
            }

            // Collect Experience (include key if non-empty)
            const experienceEntries = document.querySelectorAll('#experienceEntries .entry');
            const experience = [];
            experienceEntries.forEach(entry => {
                const affiliation = entry.querySelector('[name="experience_affiliation"]').value.trim();
                const location = entry.querySelector('[name="experience_location"]').value.trim();
                const duration = entry.querySelector('[name="experience_duration"]').value.trim();
                const position = entry.querySelector('[name="experience_position"]').value.trim();
                const descriptions = entry.querySelector('[name="experience_descriptions"]').value
                    .split('\n')
                    .map(desc => desc.trim())
                    .filter(desc => desc !== '');
                if (affiliation || location || duration || position || descriptions.length) {
                    experience.push({ affiliation, location, duration, position, descriptions });
                }
            });
            if (experience.length > 0) {
                data.Experience = experience;
            }

            // Collect Publications (include key only if non-empty)
            const publicationEntries = document.querySelectorAll('#publicationEntries .entry');
            const publications = [];
            publicationEntries.forEach(entry => {
                const authors = entry.querySelector('[name="publication_authors"]').value
                    .split(',')
                    .map(author => author.trim())
                    .filter(author => author !== '');
                const title = entry.querySelector('[name="publication_title"]').value.trim();
                const venue = entry.querySelector('[name="publication_venue"]').value.trim();
                const year = entry.querySelector('[name="publication_year"]').value.trim();
                const url = entry.querySelector('[name="publication_url"]').value.trim();
                if (authors.length || title || venue || year || url) {
                    const publication = { authors, title, venue, year };
                    if (url) publication.url = url;
                    publications.push(publication);
                }
            });
            if (publications.length > 0) {
                data.Publications = publications;
            }

            // Collect Projects (include key only if non-empty)
            const projectEntries = document.querySelectorAll('#projectEntries .entry');
            const projects = [];
            projectEntries.forEach(entry => {
                const title = entry.querySelector('[name="project_title"]').value.trim();
                const descriptions = entry.querySelector('[name="project_descriptions"]').value
                    .split('\n')
                    .map(desc => desc.trim())
                    .filter(desc => desc !== '');
                if (title || descriptions.length) {
                    projects.push({ title, descriptions });
                }
            });
            if (projects.length > 0) {
                data.Projects = projects;
            }

            // Collect Skills (include key only if non-empty)
            const skillEntries = document.querySelectorAll('#skillEntries .entry');
            const skills = {};
            skillEntries.forEach(entry => {
                const category = entry.querySelector('[name="skill_category"]').value.trim();
                const items = entry.querySelector('[name="skill_items"]').value.trim();
                if (category && items) { // Require both for valid entry
                    skills[category] = items;
                }
            });
            if (Object.keys(skills).length > 0) {
                data.Skills = skills;
            }

            // Send data to backend
            fetch('/generate_cv', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error: Failed to generate CV');
                }
                return response.blob();
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'cv.pdf';
                a.click();
                window.URL.revokeObjectURL(url);
                const output = document.getElementById('output');
                output.textContent = data.language === 'ch' ? '简历生成成功！请检查您的下载内容。' : 'CV generated successfully! Check your downloads.';
                output.classList.remove('hidden');
            })
            .catch(error => {
                const output = document.getElementById('output');
                output.textContent = error.message;
                output.classList.remove('hidden');
            });
        });
    </script>
{% endblock %}